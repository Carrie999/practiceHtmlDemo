<template>
  <div class='judge'>
    <div ref='like' class="circle cirMargin" @click="success">
      <canvas class="mask1" id="cvs" v-show='showMask && isShow'></canvas>
      <i class="iconfont icon-duigou tubiao4"></i>
    </div>
    <div ref='dislike' class="circle" @click="error">
      <canvas class="mask1" id="cvs2" v-show='showMask && isShow'></canvas>
      <i class="iconfont icon-chacha tubiao2"></i>
    </div>
    <!-- <div>{{ count }}</div> -->
  </div>
</template>

<script>
function accAdd(arg1,arg2){
    var r1,r2,m,r3;
    try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
    try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
    m=Math.pow(10,Math.max(r1,r2))
    try{
      r3=((arg1*m+arg2*m)/m).toString().split(".")[1].length
      if(Number(r3)>15){
        var cc =(arg1*m+arg2*m)/m
        return cc.toFixed(m.toString().length-1)
      }
    }
    catch(e){}
    return (arg1*m+arg2*m)/m
  }
  Number.prototype.add = function (arg){
    return accAdd(arg,this);
  }
import store from '@/vuex/store'
import {mapState,mapMutations} from 'vuex';
document.body.style.overflow = 'hidden';  
export default {
  name:"judge",
  props: {
    isShow: '',
    track: {
      type: Boolean,
      default: false
    }
  },
  data () {
    return {
      showMask:true,
      stopAnswer:true,
    }
  },
  watch:{
    track(track){
      if(track){
        // console.log(11111111,this.showMask)
      }
    } 
  },
  computed:{
    ...mapState(["count"])
  },
  methods: {
    ...mapMutations(['add','reduce']),
    success(){
      if(!this.track){
        return;
      }
      if(!this.stopAnswer){
        return;
      }
      this.stopAnswer = false;
      this.$emit('success'); 
    },
    error(){
      if(!this.track){
        return;
      }
      if(!this.stopAnswer){
        return;
      }
      this.stopAnswer = false;
      this.$emit('error'); 
    },
    rotaryShear(){
      this.add()
      // localStorage.setItem('showMask','1')
      this.showMask = true;
      var myCanvas = document.getElementById('cvs'); 
      var myCanvas2 = document.getElementById('cvs2'); 
      var myCanvas_rect = myCanvas.getBoundingClientRect(); 
      var myCanvas_rect2 = myCanvas2.getBoundingClientRect(); 
      var widths = myCanvas_rect.width; 
      var heights = myCanvas_rect.height;
      // console.log(widths,heights)
      CanvasRenderingContext2D.prototype.sector = function (x, y, radius, sDeg, eDeg) {
          // 初始保存
        this.save();
        // 位移到目标点
        this.translate(x, y);
        this.beginPath();
        // 画出圆弧
        this.arc(0,0,radius,sDeg, eDeg);
        // 再次保存以备旋转
        this.save();
        // 旋转至起始角度
        this.rotate(eDeg);
        // 移动到终点，准备连接终点与圆心
        this.moveTo(radius,0);
        // 连接到圆心
        this.lineTo(0,0);
        // 还原
        this.restore();
        // 旋转至起点角度
        this.rotate(sDeg);
        // 从圆心连接到起点
        this.lineTo(radius,0);
        this.closePath();
        // 还原到最初保存的状态
        this.restore();
        return this;
      }
      var d = new Date()
      var ctx = document.getElementById('cvs').getContext('2d');
      ctx.fillStyle='white';

      var ctx2 = document.getElementById('cvs2').getContext('2d');
      ctx2.fillStyle='white';
      // ctx.sector(100,100,50,0,Math.PI/180*230).fill();
      let n = 0;
      let gap = 2;
      let times = 0;
      let t1 = new Date().getTime();
      let t2
      let remainingTimes
      let remainingAngle
      let step = ()=>{
        ctx.sector(50,50,50,0,Math.PI/180*n).fill();
        ctx2.sector(50,50,50,0,Math.PI/180*n).fill();

        t2 = new Date().getTime()
        remainingTimes = 3000 - (t2 - t1)
        remainingAngle = 360 - n

        if(remainingTimes >= 0 && remainingTimes !== 0){
          gap = parseFloat(((remainingAngle/remainingTimes)*16.6).toFixed(2))
        }

        n += gap;
        // console.log(n)
        requestAnimation = requestAnimationFrame(step)
        // if(n >= 360 || !this.showMask){
        if(n >= 360){
          cancelAnimationFrame(requestAnimation);
          this.reduce();
          // localStorage.setItem('showMask','0')
          this.showMask = false;
          this.stopAnswer = true;
          myCanvas.width = myCanvas.width
          myCanvas.height = myCanvas.height
          myCanvas2.width = myCanvas2.width
          myCanvas2.height = myCanvas2.height
        }
      }
      setTimeout(()=>{
        console.log(new Date().getTime() - t1,'3s',n)
      },3000)

      let requestAnimation = requestAnimationFrame(step)
    },
  },
  store
}
</script>

<style scoped lang="scss">
// @import "../../assets/styles/main.scss";
.judge{
  margin-top:3rem;
  margin-bottom:1.7rem;
  display:flex;
  justify-content:center;
  .circle{ 
    position: relative;
    background:#fff;
    height:3rem;
    width:3rem;
    border-radius:1.5rem;
    z-index: 1;
    overflow: hidden;
    .tubiao1{
      line-height:3rem;
      font-size:1.5rem;;
      color:#FF6A6A;
    }
    .tubiao2{
      line-height:3rem;
      font-size:1.35rem;
      color:#D6262B;
    }
     .tubiao4{
      line-height:3rem;
      font-size:1.5rem;
      color:#76C465;
    }
  }
  .cirMargin{
    margin-right:4.75rem;
  }
}

.mask1{
  width: 12rem;
  height: 6rem;
  position: absolute;
  z-index: 1;
  left: -3.5rem;
  bottom: 7.9rem;
  top:0;
  right:0;
  margin:auto;
  transform: rotate(270deg);
  background: #000;
  opacity: 0.25;
  border-radius: 10rem;
}
</style>
